<%
  require 'json'

  def create_keypairs(keypairs)
    keypairs = []
    if_p("frontend_tls_keypairs").each { |cert_pair|
      pair = {
        "CertChain" => cert_pair.cert_chain,
        "PrivateKey" => cert_pair.private_key
      }

      keypairs << pair
    }

    keypairs.to_json
  end
%>
{
  "ListenAddressForCloudController": "0.0.0.0:<%= p('listen_port_for_cloud_controller') %>",
  "ListenAddressForMCP": "0.0.0.0:<%= p('listen_port_for_mcp') %>",
  "PilotClientCAPath": "/var/vcap/jobs/copilot/config/certs/pilot-client-ca.crt",
  "CloudControllerClientCAPath": "/var/vcap/jobs/copilot/config/certs/cloud-controller-client-ca.crt",
  "ServerCertPath": "/var/vcap/jobs/copilot/config/certs/server.crt",
  "ServerKeyPath": "/var/vcap/jobs/copilot/config/certs/server.key",
  "VIPCIDR": "<%= p('experimental_vip_cidr') %>",
  "BBS": {
    "ServerCACertPath": "/var/vcap/jobs/copilot/config/bbs/certs/ca.crt",
    "ClientCertPath": "/var/vcap/jobs/copilot/config/bbs/certs/client.crt",
    "ClientKeyPath": "/var/vcap/jobs/copilot/config/bbs/certs/client.key",
    "Address": "<%= p('bbs.address') %>",
    "ClientSessionCacheSize": <%= p('bbs.client_session_cache_size') %>,
    "MaxIdleConnsPerHost": <%= p('bbs.max_idle_conns_per_host') %>,
    "SyncInterval": "<%= p('bbs.sync_interval') %>"
  },
  "TLSPems": <%= if_p("frontend_tls_keypairs") { |keypairs| create_keypairs(keypairs) } %>
}
