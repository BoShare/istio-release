<%=

  pilots = []
  link("pilot").instances.each do |instance|
    pilots << {"url": "tcp://#{instance.address}:8080"}
  end

config = {
  "listeners": [],
  "lds": {
    "cluster": "pilot-sd"
  },
  "admin": {
    "access_log_path": "/dev/null",
    "address": "tcp://0.0.0.0:8001"
  },
  "cluster_manager": {
    "cds": {
      "cluster": {
        "name": "pilot-cds",
        "type": "static",
        "connect_timeout_ms": 250,
        "lb_type": "round_robin",
        "hosts": pilots,
      }
    },
    "sds": {
      "cluster": {
        "name": "pilot-sds",
        "type": "static",
        "connect_timeout_ms": 250,
        "lb_type": "round_robin",
        "hosts": pilots,
      },
      "refresh_delay_ms": 150
    },
    "clusters": [
      {
        "name": "pilot-sd",
        "type": "static",
        "connect_timeout_ms": 250,
        "lb_type": "round_robin",
        "hosts": pilots,
      },
      {
        "name": "rds",
        "type": "static",
        "connect_timeout_ms": 250,
        "lb_type": "round_robin",
        "hosts": pilots,
      }
    ]
  }
}
config.to_json()

%>

