---
processes:
- name: pilot-discovery
  executable: /var/vcap/packages/pilot/bin/pilot-discovery
  args:
  - discovery
  - --configDir=/var/vcap/jobs/pilot-discovery/config/istio
  - --registries=CloudFoundry
  - --cfConfig=/var/vcap/jobs/pilot-discovery/config/cf_config.yml
  - --meshConfig=/dev/null
  - --plugins=health
  - --httpAddr=0.0.0.0:<%= p('port') %>
  - --mcpServerAddrs=0.0.0.0:<%= link('mcp_conn').p('listen_port_for_mcp') %>
  env:
    PILOT_ALLOW_CONCURRENT: "true"
    V2_REFRESH: "30s"
    PILOT_CACHE_SQUASH: "30"
    PILOT_PUSH_THROTTLE: "50"
