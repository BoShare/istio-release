---
processes:
- name: pilot-discovery
  executable: /var/vcap/packages/pilot/bin/pilot-discovery
  args:
  - discovery
  - --configDir=/dev/null
  - --registries=MCP
  - --meshConfig=/dev/null
  - --plugins=health
  - --httpAddr=0.0.0.0:<%= p('port') %>
  - --mcpServerAddrs=mcps://0.0.0.0:<%= link('mcp_conn').p('listen_port_for_mcp') %>
  - --certFile=/var/vcap/jobs/pilot-discovery/config/certs/client.crt
  - --keyFile=/var/vcap/jobs/pilot-discovery/config/certs/client.key
  - --caCertFile=/var/vcap/jobs/pilot-discovery/config/certs/ca.crt
  env:
    PILOT_ALLOW_CONCURRENT: "true"
    V2_REFRESH: "30s"
    PILOT_CACHE_SQUASH: "30"
    PILOT_PUSH_THROTTLE: "50"
