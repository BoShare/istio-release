set -exu

# running dep requires files to be under $GOPATH/src
mkdir ${BUILD_DIR}/src
mv ${BUILD_DIR}/istio.io ${BUILD_DIR}/src/istio.io
GOPATH=${BUILD_DIR}

go get -u github.com/golang/dep/cmd/dep

export PATH=$PATH:$GOPATH/bin

pushd ${BUILD_DIR}/src/istio.io/istio/pilot
  dep ensure
popd

# clean up directory structure only needed for running dep
mv ${BUILD_DIR}/src/istio.io ${BUILD_DIR}/istio.io
rm -rf ${BUILD_DIR}/src
